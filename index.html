<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OrderTrack è¨‚å–®ç®¡å®¶ v11.0</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FFFBF5">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* v11.0 æ–°å¢æ¨£å¼ï¼šå¼·åˆ¶å°å¼•è¦–çª— */
        .onboarding-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-color); z-index: 12000;
            display: none; justify-content: center; align-items: center;
            padding: 20px;
        }
        .onboarding-box {
            background: white; padding: 40px 30px; border-radius: 24px;
            box-shadow: 0 10px 40px rgba(92, 64, 51, 0.15); 
            width: 100%; max-width: 400px; text-align: center;
        }
        .onboarding-icon { font-size: 60px; margin-bottom: 20px; display: block; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-box">
            <div class="auth-header">
                <div class="auth-logo">ğŸ““</div>
                <div class="auth-title">OrderTrack</div>
                <div class="auth-subtitle">æ‰‹ä½œè·äººçš„é›²ç«¯ç®¡å®¶</div>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')" id="tab-login">ç™»å…¥</button>
                <button class="auth-tab" onclick="switchAuthTab('register')" id="tab-register">å“ç‰Œè¨»å†Š</button>
            </div>

            <div id="view-login">
                <div class="role-switch">
                    <label><input type="radio" name="loginRole" value="owner" checked onchange="toggleLoginMode()"> è² è²¬äºº</label>
                    <label><input type="radio" name="loginRole" value="staff" onchange="toggleLoginMode()"> åœ˜éšŠå¤¥ä¼´</label>
                </div>
                <div id="login-owner-fields">
                    <input type="email" id="loginEmail" class="form-input" placeholder="è² è²¬äºº Email">
                </div>
                <div id="login-staff-fields" style="display:none;">
                    <input type="text" id="loginTeamCode" class="form-input" placeholder="åœ˜éšŠä»£è™Ÿ">
                    <input type="text" id="loginUsername" class="form-input" placeholder="å“¡å·¥å¸³è™Ÿ">
                </div>
                <input type="password" id="loginPassword" class="form-input" placeholder="å¯†ç¢¼">
                <button class="auth-btn btn-login" onclick="handleLogin()">é€²å…¥ç³»çµ±</button>
            </div>

            <div id="view-register" style="display:none;">
                <p style="font-size:13px; color:#666; margin-bottom:15px; line-height:1.5;">
                    æ­¡è¿åŠ å…¥ï¼è¨»å†Šå¾Œéœ€é©—è­‰ Emailï¼Œ<br>é¦–æ¬¡ç™»å…¥æ™‚å†è¨­å®šæ‚¨çš„å“ç‰Œè³‡è¨Šã€‚
                </p>
                <input type="text" id="regInviteCode" class="form-input highlight-input" placeholder="é‚€è«‹ç¢¼ (å¿…å¡«)">
                <input type="email" id="regEmail" class="form-input" placeholder="Email (å°‡ä½œç‚ºå¸³è™Ÿ)">
                <input type="password" id="regPassword" class="form-input" placeholder="è¨­å®šå¯†ç¢¼ (è‡³å°‘6ä½)">
                <button class="auth-btn btn-signup" onclick="handleRegister()">è¨»å†Šä¸¦ç™¼é€é©—è­‰ä¿¡</button>
            </div>

            <div id="auth-msg" class="auth-message"></div>
        </div>
    </div>

    <div id="onboarding-overlay" class="onboarding-overlay">
        <div class="onboarding-box">
            <span class="onboarding-icon">âœ¨</span>
            <h2 class="auth-title">æ­¡è¿ä¾†åˆ° OrderTrack</h2>
            <p style="color:#666; margin-bottom:24px; font-size:14px;">
                æ‚¨çš„å¸³è™Ÿå·²å•Ÿç”¨ï¼<br>ç¾åœ¨ï¼Œè«‹ç‚ºæ‚¨çš„å“ç‰Œå»ºç«‹ä¸€å€‹å®¶ã€‚
            </p>
            
            <label class="form-label" style="text-align:left;">å“ç‰Œåç¨±</label>
            <input type="text" id="setupBrandName" class="form-input" placeholder="ä¾‹å¦‚: é£¾å“å·¥ä½œå®¤">
            
            <label class="form-label" style="text-align:left;">åœ˜éšŠä»£è™Ÿ (å“¡å·¥ç™»å…¥ç”¨)</label>
            <input type="text" id="setupTeamCode" class="form-input" placeholder="è‹±æ–‡æ•¸å­—ï¼Œä¾‹å¦‚: MYSHOP">
            
            <label class="form-label" style="text-align:left;">ç¢ºèªé‚€è«‹ç¢¼</label>
            <input type="text" id="setupInviteCode" class="form-input" placeholder="è«‹å†æ¬¡è¼¸å…¥é‚€è«‹ç¢¼">

            <button class="auth-btn btn-login" onclick="handleOnboarding()">é–‹å§‹ä½¿ç”¨</button>
        </div>
    </div>

    <div class="lightbox-overlay" id="lightbox" onclick="closeLightbox()"><img class="lightbox-img" id="lightboxImg" src=""></div>
    <div class="loading-overlay" id="loading"><div class="spinner"></div><div class="loading-text">è™•ç†ä¸­...</div></div>

    <header>
        <div class="top-row">
            <h1 id="appHeaderTitle">ğŸ““ OrderTrack</h1>
            <div class="header-actions">
                <button class="icon-btn" onclick="openStats()" title="çµ±è¨ˆ">ğŸ“Š</button>
                <button class="icon-btn" onclick="openSettings()" title="è¨­å®š">âš™ï¸</button>
            </div>
        </div>
        <div class="controls-container">
            <div class="search-row"><input type="text" class="search-input" id="searchInput" placeholder="æœå°‹..." oninput="renderTasks()"></div>
            <div class="filter-controls">
                <select class="control-select" id="timeFilter" onchange="renderTasks()">
                    <option value="all">ğŸ“… å…¨éƒ¨æ™‚é–“</option><option value="today">ä»Šå¤©</option><option value="week">æœ¬é€±</option><option value="month">æœ¬æœˆ</option>
                </select>
                <select class="control-select" id="sortOrder" onchange="renderTasks()">
                    <option value="newest">â–¼ æœ€æ–°</option><option value="oldest">â–² æœ€èˆŠ</option>
                </select>
                <label class="filter-toggle"><input type="checkbox" class="checkbox" id="showCompleted" onchange="renderTasks()"> å·²å®Œæˆ</label>
            </div>
        </div>
    </header>

    <div class="filters" id="topFilterContainer"></div>
    <div class="container" id="cardContainer"></div>
    <button class="fab" onclick="openModal()">+</button>
    <div class="toast" id="toast">å·²è¤‡è£½</div>

    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <h3 id="modalTitle" style="text-align:center; margin-bottom:16px;">æ–°å¢ä»»å‹™</h3>
            <label class="form-label">æŒ‡æ´¾çµ¦</label><div class="selector-scroll-container" id="assigneeSelector"></div>
            <label class="form-label">ä¾†æº</label><div class="selector-scroll-container" id="platformSelectorContainer"></div>
            <label class="form-label">é¡å‹</label><div class="selector-scroll-container" id="typeSelectorContainer"></div>
            <div style="display:flex; gap:10px;"><div style="flex:2;"><label class="form-label">ID/å§“å</label><input type="text" class="form-input" id="inputIg"></div><div style="flex:1;"><label class="form-label">é‡‘é¡</label><input type="number" class="form-input" id="inputPrice" placeholder="0"></div></div>
            <label class="form-label">æ™‚é–“</label><input type="datetime-local" class="form-input" id="inputTime">
            <label class="form-label">ç…§ç‰‡</label><div class="image-upload-box" onclick="document.getElementById('fileInput').click()">ğŸ“· ä¸Šå‚³<img id="previewImage"></div><input type="file" id="fileInput" accept="image/*" style="display:none" onchange="previewFile()">
            <label class="form-label">å‚™è¨»</label><textarea class="form-textarea" id="inputNote" rows="2"></textarea>
            <button id="modalSubmitBtn" class="auth-btn btn-login" onclick="saveTask()">å„²å­˜</button><button class="btn-delete-task" id="btnDeleteTask" onclick="deleteTask()">ğŸ—‘ï¸ åˆªé™¤</button><button class="auth-btn btn-signup" style="border:none; color:#999;" onclick="closeModal('taskModal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="modal-overlay" id="customItemModal">
        <div class="modal"><h3 style="text-align:center;">æ–°å¢è‡ªå®šç¾©</h3><input type="text" class="form-input" id="customName"><div class="preview-icon-display" id="emojiPreviewDisplay">ğŸŒ</div><div class="emoji-grid-container" id="emojiGrid"></div><div id="colorPickerSection" class="color-picker-container"><div class="color-grid" id="colorGrid"></div></div><button class="auth-btn btn-login" onclick="saveCustomItem()">ç¢ºèª</button><button class="auth-btn btn-signup" onclick="closeModal('customItemModal')">å–æ¶ˆ</button></div>
    </div>

    <div class="modal-overlay" id="staffModal">
        <div class="modal"><h3 style="text-align:center;">æ–°å¢å¤¥ä¼´</h3><p style="font-size:12px;color:#666;text-align:center;margin-bottom:15px;">å¤¥ä¼´ä½¿ç”¨åœ˜éšŠä»£è™Ÿç™»å…¥</p><label class="form-label">å¸³è™Ÿ</label><input type="text" class="form-input" id="staffUsername"><label class="form-label">å¯†ç¢¼</label><input type="text" class="form-input" id="staffPassword"><label class="form-label">æ¬Šé™</label><div style="background:#F8F4F0;padding:10px;border-radius:8px;"><label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;"><input type="checkbox" id="permStats"> æŸ¥çœ‹å ±è¡¨</label><label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;"><input type="checkbox" id="permTags" checked> ç®¡ç†æ¨™ç±¤</label><label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="permDelete"> åˆªé™¤ä»»å‹™</label></div><button class="auth-btn btn-login" onclick="saveStaff()">å»ºç«‹</button><button class="auth-btn btn-signup" onclick="closeModal('staffModal')">å–æ¶ˆ</button></div>
    </div>

    <div class="modal-overlay" id="statsModal">
        <div class="modal"><h3 style="text-align:center;">ğŸ“Š çµ±è¨ˆ</h3><div class="stats-row"><input type="date" class="form-input" id="statsStart" onchange="calculateStats()"><input type="date" class="form-input" id="statsEnd" onchange="calculateStats()"></div><select class="form-input" id="statsTypeSelect" onchange="calculateStats()"></select><div class="stats-result"><div class="stat-box"><span class="stat-value" id="statIncome">$0</span><span class="stat-label">ç‡Ÿæ”¶</span></div><div class="stat-box"><span class="stat-value" id="statCount">0</span><span class="stat-label">å–®æ•¸</span></div></div><button class="auth-btn btn-login" style="margin-top:20px;" onclick="closeModal('statsModal')">é—œé–‰</button></div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal"><h3 style="text-align:center;">è¨­å®š</h3><div id="ownerSettings"><div class="settings-section"><div class="settings-header" onclick="toggleSection('secTeam',this)"><span class="settings-title">ğŸ‘¥ åœ˜éšŠç®¡ç† <span id="staffCountBadge" style="font-size:12px;background:#eee;padding:2px 6px;border-radius:10px;">0/2</span></span><span class="chevron">â–¼</span></div><div id="secTeam" class="settings-body"><div id="staffList"></div><button class="custom-item-btn" style="width:100%;margin-top:8px;background:var(--text-main);" onclick="openStaffModal()">+ æ–°å¢</button></div></div><div class="settings-section"><div class="settings-header" onclick="toggleSection('secTemplates',this)"><span class="settings-title">ğŸ“ æ–‡æ¡ˆæ¨¡ç‰ˆ</span><span class="chevron">â–¼</span></div><div id="secTemplates" class="settings-body"><div id="templatesList"></div></div></div><div class="settings-section"><div class="settings-header" onclick="toggleSection('secCustom',this)"><span class="settings-title">ğŸ› ï¸ é¸é …ç®¡ç†</span><span class="chevron">â–¼</span></div><div id="secCustom" class="settings-body"><label class="form-label" style="font-size:12px;">ä¾†æº</label><div id="customPlatformsList"></div><label class="form-label" style="font-size:12px;margin-top:8px;">é¡å‹</label><div id="customTypesList"></div></div></div></div><div class="settings-section" style="border:none;"><div class="settings-title">ğŸ‘¤ å¸³è™Ÿ</div><div class="settings-info-row"><span>èº«ä»½</span><span id="settingRole" style="font-weight:bold;"></span></div><button class="logout-btn-large" onclick="signOut()">ç™»å‡º</button></div><button class="auth-btn btn-login" onclick="closeModal('settingsModal')">å®Œæˆ</button></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
